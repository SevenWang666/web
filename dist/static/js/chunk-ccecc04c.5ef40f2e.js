(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-ccecc04c"],{"20f9":function(e,t,s){},"49fe":function(e,t,s){"use strict";var i=s("20f9");s.n(i).a},9852:function(e,t,s){"use strict";s.r(t),s("96cf");var i,n,o,a,r,c,p,u,l,d=s("3b8d"),m=s("1fba"),h={data:function(){var e=this;return{pageTitle:"",bottomButtons:[{class:"button-delete",text:"删除",callback:this.deleteExpense},{class:"button-save",text:"保存",callback:function(){e.saveExpense(!0)}}],swipeBtn:[{action:"delete",text:"删除",color:"#ff3a32"}],isNew:!1,originTitle:!0,headInfo:{},businessInfo:{},expenseDesc:"",linkedRequisitions:[],linkedInvoices:[],sourceTypes:[]}},created:(l=Object(d.a)(regeneratorRuntime.mark(function e(){var t,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=this.$route.query.pool_id)){e.next=14;break}return this.isNew=!0,this.pageTitle="新增账本",e.next=7,this.initHeadInfo();case 7:s=e.sent,this.headInfo=s,this.headInfo.expenseDate=s.currentDate,this.businessInfo={moExpPoolTypeName:sessionStorage.getItem("moExpPoolTypeName")||"请选择",moExpPoolTypeId:sessionStorage.getItem("moExpPoolTypeId")||0,confirmFlag:sessionStorage.getItem("confirmFlag")||"Y",businessTypeName:sessionStorage.getItem("businessTypeName")||"费用类型",busRefId:sessionStorage.getItem("busRefId")||0,amount:sessionStorage.getItem("expenseAmount")||"0.00",companyAmount:"0.00",sourceType:"MANUAL"},e.next=26;break;case 14:return this.isNew=!1,this.pageTitle="账本详情",e.next=18,this.getExpenseDetail(t);case 18:i=e.sent,this.cleanStorage(),this.headInfo={companyName:i.companyName,unitName:i.unitName,respCenterName:i.respCenterName,respCenterId:i.respCenterId,expenseDate:i.expenseDate,companyId:i.companyId,unitId:i.unitId,accEntityId:i.accEntityId,employeeId:i.employeeId,currencyCode:i.currencyCode},this.businessInfo={moExpPoolTypeName:i.moExpPoolTypeName,moExpPoolTypeId:i.moExpPoolTypeId,businessTypeName:i.businessTypeName,busRefId:i.busRefId,amount:i.amount,companyAmount:i.companyAmount,sourceType:i.sourceType},this.expenseDesc=i.description,this.queryRequisitions(),this.queryInvoices();case 26:this.getPoolTypes();case 27:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)}),mounted:function(){new m.a(this.$refs.datas,{})},methods:{showTitle:function(){this.originTitle=!this.originTitle},getExpenseDetail:(u=Object(d.a)(regeneratorRuntime.mark(function e(t){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post({url:"/app/expense-pool/appExpDetailQuery",para:{poolId:t,page:1,zSize:10}});case 2:return s=e.sent,e.abrupt("return",s.rows[0]);case 4:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)}),initHeadInfo:(p=Object(d.a)(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get({url:"/app/expense-pool/appPoolInit?page=1&size=10"});case 2:return t=e.sent,s=t.rows[0],e.abrupt("return",s);case 5:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)}),getPoolTypes:(c=Object(d.a)(regeneratorRuntime.mark(function e(){var t,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post({url:"/app/expense-pool/appExpPoolTypeQuery",para:{page:1,zSize:10}});case 2:for(t=e.sent,s=t.rows,i=0;i<s.length;i++)this.sourceTypes.push({text:s[i].description,value:{id:s[i].moExpPoolTypeId,flag:s[i].confirmFlag}});case 5:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)}),selectPoolType:function(e,t,s){var i=e[0];this.businessInfo.moExpPoolTypeId=i.id,this.businessInfo.confirmFlag=i.flag,this.businessInfo.moExpPoolTypeName=s[0]},getPoolType:function(){this.pickers||(this.pickers=this.$createPicker({title:"费用类型",data:[this.sourceTypes],onSelect:this.selectPoolType,onCancel:function(){}})),this.pickers.show()},selectBusinessType:function(){"请选择"!=this.businessInfo.moExpPoolTypeName?(sessionStorage.setItem("moExpPoolTypeName",this.businessInfo.moExpPoolTypeName),sessionStorage.setItem("moExpPoolTypeId",this.businessInfo.moExpPoolTypeId),sessionStorage.setItem("confirmFlag",this.businessInfo.confirmFlag),this.$router.push({name:"select_expense_ref",query:{typeId:this.businessInfo.moExpPoolTypeId}})):this.$createToast({txt:"请先选择费用池类型",type:"txt"}).show()},inputCompanyAmount:function(){var e=this;this.$createKeyboard({value:this.value,onConfirm:function(t){e.businessInfo.companyAmount=t}}).show()},linkRequisition:function(){if(this.isNew){if("请选择"==this.businessInfo.moExpPoolTypeName)return void this.$createToast({txt:"请选择费用池类型",type:"txt"}).show();if("费用类型"==this.businessInfo.businessTypeName)return void this.$createToast({txt:"请选择费用类型",type:"txt"}).show();if("0.00"==this.businessInfo.amount)return void this.$createToast({txt:"请输入金额",type:"txt"}).show();if("0.00"==this.businessInfo.companyAmount)return void this.$createToast({txt:"请输入公司承担金额",type:"txt"}).show();this.saveExpense(!1,"relate_requisition")}else this.$router.push({name:"relate_requisition",query:{poolId:this.$route.query.pool_id,moExpPoolTypeId:this.businessInfo.moExpPoolTypeId,busRefId:this.businessInfo.busRefId}})},linkInvoice:function(){if(this.$route.query.pool_id,this.isNew){if("请选择"==this.businessInfo.moExpPoolTypeName)return void this.$createToast({txt:"请选择费用池类型",type:"txt"}).show();if("费用类型"==this.businessInfo.businessTypeName)return void this.$createToast({txt:"请选择费用类型",type:"txt"}).show();if("0.00"==this.businessInfo.amount)return void this.$createToast({txt:"请输入金额",type:"txt"}).show();if("0.00"==this.businessInfo.companyAmount)return void this.$createToast({txt:"请输入公司承担金额",type:"txt"}).show();this.saveExpense(!1,"relate_invoice")}else this.$router.push({name:"relate_invoice",query:{poolId:this.$route.query.pool_id,employeeId:this.headInfo.employeeId,accEntityId:this.headInfo.accEntityId}})},queryRequisitions:(r=Object(d.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post({url:"/app/expense-pool/expensePoolRefReqQuery",para:{poolId:this.$route.query.pool_id,page:1,zSize:10}});case 2:t=e.sent,this.linkedRequisitions=t.rows;case 6:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)}),queryInvoices:(a=Object(d.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post({url:"/app/expense-pool/expensePoolRefVatQuery",para:{poolId:this.$route.query.pool_id,page:1,zSize:10}});case 2:t=e.sent,this.linkedInvoices=t.rows;case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)}),onSwipeBtnClick:(o=Object(d.a)(regeneratorRuntime.mark(function e(t,s){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.$route.query.pool_id,!t){e.next=6;break}return e.next=4,this.$post({url:"/app/expense-pool/expensePoolRefVatSubmit",para:{lines:[{poolId:parseInt(i),invoiceId:s.invoiceId,refId:s.refId,status:"delete"}]}});case 4:e.sent.success&&this.linkedInvoices.splice(s.index,1);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)}),saveExpense:(n=Object(d.a)(regeneratorRuntime.mark(function e(t,s){var i,n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={respCenterName:this.headInfo.respCenterName,respCenterId:this.headInfo.respCenterId,moExpPoolTypeId:parseInt(this.businessInfo.moExpPoolTypeId),busRefId:this.businessInfo.busRefId,accEntityId:this.headInfo.accEntityId,companyId:this.headInfo.companyId,unitId:this.headInfo.unitId,employeeId:this.headInfo.employeeId,currencyCode:this.headInfo.currencyCode,expenseDate:this.headInfo.expenseDate,amount:parseFloat(this.businessInfo.amount),companyAmount:parseFloat(this.businessInfo.companyAmount),sourceType:this.businessInfo.sourceType,description:this.expenseDesc,confirmFlag:this.businessInfo.confirmFlag},this.isNew||(i.poolId=parseInt(this.$route.query.pool_id)),e.next=4,this.$post({url:"/app/expense-pool/submit",para:i});case 4:(n=e.sent).success&&(t?this.goBack():(this.cleanStorage(),o=n.rows[0].poolId,"relate_requisition"==s?a={poolId:o,moExpPoolTypeId:this.businessInfo.moExpPoolTypeId,busRefId:this.businessInfo.busRefId}:"relate_invoice"==s&&(a={poolId:o,employeeId:this.headInfo.employeeId,accEntityId:this.headInfo.accEntityId}),this.$router.push({name:s,query:a})));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)}),goBack:function(){this.cleanStorage(),this.$router.go(-1)},cleanStorage:function(){sessionStorage.removeItem("moExpPoolTypeId"),sessionStorage.removeItem("companyAmount"),sessionStorage.removeItem("businessTypeName"),sessionStorage.removeItem("confirmFlag"),sessionStorage.removeItem("busRefId"),sessionStorage.removeItem("moExpPoolTypeName"),sessionStorage.removeItem("expenseAmount")},deleteExpense:(i=Object(d.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$route.query.pool_id,e.next=3,this.$post({url:"/app/exp/expense-pool/appExpPoolDel",para:{poolId:t}});case 3:e.sent,this.goBack();case 5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},computed:{collapseMargin:function(){return this.originTitle?"0px":"12px"},collapseTitle:function(){return this.originTitle?"收起":"展开"}}},v=(s("49fe"),s("2877")),f=Object(v.a)(h,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("au-view",{ref:"view",staticClass:"view-container",attrs:{hasHeader:!0,bottomSize:50,hasFooter:!0,hasBack:!1}},[s("div",{attrs:{slot:"left"},on:{click:function(t){return e.goBack()}},slot:"left"},[s("div",{staticClass:"back-btn iconfont hec-icon-fanhui"})]),s("div",{attrs:{slot:"center"},slot:"center"},[e._v(e._s(e.pageTitle))]),s("div",{ref:"datas",staticClass:"datas"},[s("au-collapse",{attrs:{titleWrapperStyle:{marginTop:"12px",marginBottom:"12px"},isReverse:!0,autoExpand:!0,collapseStyle:{backgroundColor:"#EAECEE",marginTop:e.collapseMargin},clickEffect:!1}},[s("div",{staticClass:"show-more",attrs:{slot:"title"},on:{click:e.showTitle},slot:"title"},[s("div",{staticClass:"title-wrapper"},[s("span",{staticClass:"gray-line"}),s("div",{ref:"titleText",staticClass:"title-text"},[e._v("\n              "+e._s(e.collapseTitle)+"\n            ")]),s("span",{staticClass:"gray-line"})])]),s("div",{staticClass:"content-wrapper",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"header"},[e._v("头信息")]),s("span",{staticClass:"split-line"}),s("div",{staticClass:"content-items"},[s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("公司")]),s("div",{staticClass:"item-sub-title"},[e._v("\n                "+e._s(e.headInfo.companyName)+"\n              ")])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("部门")]),s("div",{staticClass:"item-sub-title"},[e._v(e._s(e.headInfo.unitName))])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("责任中心")]),s("div",{staticClass:"item-sub-title"},[e._v("\n                "+e._s(e.headInfo.respCenterName)+"\n              ")])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("费用发生日期")]),s("div",{staticClass:"item-sub-title"},[e._v(e._s(e.headInfo.expenseDate))])])])])]),s("div",{staticClass:"content-wrapper"},[s("div",{staticClass:"header"},[e._v("费用信息")]),s("span",{staticClass:"split-line"}),s("div",{staticClass:"content-items"},[s("div",{staticClass:"pool-type-wrapper"},[s("div",{staticClass:"item-title"},[e._v("费用池类型")]),s("div",{staticClass:"item-sub-title",on:{click:e.getPoolType}},[e._v("\n              "+e._s(e.businessInfo.moExpPoolTypeName)+"\n              "),s("i",{staticClass:"cubeic-arrow"})])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v(e._s(e.businessInfo.businessTypeName))]),s("div",{staticClass:"item-sub-title",on:{click:e.selectBusinessType}},[e._v("\n              CNY "+e._s(e.businessInfo.amount)+"\n              "),s("i",{staticClass:"cubeic-arrow"})])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("公司承担金额")]),s("div",{staticClass:"item-sub-title",on:{click:e.inputCompanyAmount}},[e._v("\n              CNY "+e._s(e.businessInfo.companyAmount)+"\n              "),s("i",{staticClass:"cubeic-edit"})])]),s("div",{staticClass:"margin-wrapper"}),s("div",{staticClass:"content-wrapper desc-wrapper"},[s("div",{staticClass:"header"},[e._v("账本信息说明")]),s("span",{staticClass:"split-line"}),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.expenseDesc,expression:"expenseDesc"}],staticClass:"textarea",attrs:{placeholder:"请输入账本信息说明"},domProps:{value:e.expenseDesc},on:{input:function(t){t.target.composing||(e.expenseDesc=t.target.value)}}})])])]),s("au-swipe",[s("div",{staticClass:"button-wrapper"},[s("div",{staticClass:"header"},[e._v("申请单关联")]),s("span",{staticClass:"split-line"}),e._l(e.linkedRequisitions,function(t,i){return s("au-swipe-item",{key:i,staticClass:"requisition-wrapper",attrs:{btns:e.swipeBtn}},[s("div",[s("div",{staticClass:"line"},[s("div",{staticClass:"number"},[e._v("\n                  "+e._s(t.expRequisitionNumber)+"\n                ")]),s("div",{staticClass:"line-num"},[e._v("行号："+e._s(t.lineNumber))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"name"},[e._v("\n                  项目名称："+e._s(t.moReqItemName)+"\n                ")])]),s("div",{staticClass:"line"},[s("div",{staticClass:"payment"},[s("div",{staticClass:"code"},[e._v("\n                    "+e._s(t.paymentCurrencyCode)+"\n                  ")]),e._v("\n                   \n                  "),s("div",{staticClass:"amount"},[e._v(e._s(t.paymentPrice))])])])])])}),s("div",{staticClass:"button",on:{click:e.linkRequisition}},[s("div",{staticClass:"dotted-button"},[s("div",{staticClass:"button-content"},[s("div",{staticClass:"button-content-text"},[e._v("新增申请单")]),s("div",{staticClass:"button-content-add"},[e._v("+")])])])])],2)]),s("au-swipe",[s("div",{staticClass:"button-wrapper"},[s("div",{staticClass:"header"},[e._v("发票关联")]),s("span",{staticClass:"split-line"}),e._l(e.linkedInvoices,function(t,i){return s("au-swipe-item",{key:i,staticClass:"requisition-wrapper",attrs:{btns:e.swipeBtn},on:{"btn-click":function(s){return e.onSwipeBtnClick(!0,{invoiceId:t.invoiceId,refId:t.refId,index:i})}}},[s("div",[s("div",{staticClass:"line num"},[s("div",{staticClass:"number"},[e._v("NO."+e._s(t.invoiceNumber))]),s("div",{staticClass:"date"},[e._v(e._s(t.invoiceDate))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"type-name"},[e._v(e._s(t.invoiceTypeName))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"code"},[e._v("发票代码："+e._s(t.invoiceCode))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"payment"},[s("div",{staticClass:"code"},[e._v("CNY")]),e._v("\n                   \n                  "),s("div",{staticClass:"amount"},[e._v(e._s(t.amount))])])])])])}),s("div",{staticClass:"button",on:{click:e.linkInvoice}},[s("div",{staticClass:"dotted-button"},[s("div",{staticClass:"button-content"},[s("div",{staticClass:"button-content-text"},[e._v("新增发票")]),s("div",{staticClass:"button-content-add"},[e._v("+")])])])])],2)])],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"select-container"},[s("au-footer-bar",{attrs:{buttons:e.bottomButtons}})],1)])])],1)},[],!1,null,"19e7fe1a",null);t.default=f.exports}}]);