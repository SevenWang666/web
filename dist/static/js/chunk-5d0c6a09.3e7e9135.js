(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d0c6a09"],{"3a0a":function(e,t,s){"use strict";var i=s("6ceb"),n=s.n(i);n.a},"6ceb":function(e,t,s){},"930a":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("au-view",{ref:"view",staticClass:"view-container",attrs:{hasHeader:!0,bottomSize:50,hasFooter:!0,hasBack:!1}},[s("div",{attrs:{slot:"left"},slot:"left"},[s("div",{staticClass:"back-btn iconfont hec-icon-fanhui",on:{click:e.goBack}})]),s("div",{attrs:{slot:"center"},slot:"center"},[e._v("新增账本费用")]),s("div",{ref:"datas",staticClass:"datas"},[s("au-collapse",{attrs:{titleWrapperStyle:{marginTop:"12px",marginBottom:"12px"},isReverse:!0,autoExpand:!0,collapseStyle:{backgroundColor:"#EAECEE",marginTop:e.collapseMargin},clickEffect:!1}},[s("div",{staticClass:"show-more",attrs:{slot:"title"},on:{click:e.showTitle},slot:"title"},[s("div",{staticClass:"title-wrapper"},[s("span",{staticClass:"gray-line"}),s("div",{ref:"titleText",staticClass:"title-text"},[e._v("\n              "+e._s(e.collapseTitle)+"\n            ")]),s("span",{staticClass:"gray-line"})])]),s("div",{staticClass:"content-wrapper",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"header"},[e._v("头信息")]),s("span",{staticClass:"split-line"}),s("div",{staticClass:"content-items"},[s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("公司")]),s("div",{staticClass:"item-sub-title"},[e._v("\n                "+e._s(e.headInfo.companyName)+"\n              ")])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("部门")]),s("div",{staticClass:"item-sub-title"},[e._v(e._s(e.headInfo.unitName))])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("责任中心")]),s("div",{staticClass:"item-sub-title"},[e._v("\n                "+e._s(e.headInfo.respCenterName)+"\n              ")])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("费用发生日期")]),s("div",{staticClass:"item-sub-title"},[e._v(e._s(e.expenseDate))])])])])]),s("div",{staticClass:"content-wrapper"},[s("div",{staticClass:"header"},[e._v("费用信息")]),s("span",{staticClass:"split-line"}),s("div",{staticClass:"content-items"},[s("div",{staticClass:"pool-type-wrapper"},[s("div",{staticClass:"item-title"},[e._v("费用池类型")]),s("div",{staticClass:"item-sub-title",on:{click:e.poolType}},[e._v("\n              "+e._s(e.poolText)+"\n              "),s("i",{staticClass:"cubeic-arrow"})])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v(e._s(e.refTypeText))]),s("div",{staticClass:"item-sub-title",on:{click:e.selectType}},[e._v("\n              "+e._s(e.refBusText)+"\n              "),s("i",{staticClass:"cubeic-arrow"})])]),s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-title"},[e._v("公司承担金额")]),s("div",{staticClass:"item-sub-title",on:{click:e.showKeyboard}},[e._v("\n              CNY "+e._s(e.reimburseExpense)+"\n              "),s("i",{staticClass:"cubeic-edit"})])]),s("div",{staticClass:"margin-wrapper"}),s("div",{staticClass:"content-wrapper desc-wrapper"},[s("div",{staticClass:"header"},[e._v("账本信息说明")]),s("span",{staticClass:"split-line"}),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.expenseDesc,expression:"expenseDesc"}],staticClass:"textarea",attrs:{placeholder:e.placeholder},domProps:{value:e.expenseDesc},on:{input:function(t){t.target.composing||(e.expenseDesc=t.target.value)}}})])])]),e.showRefVat?s("div",{staticClass:"button-wrapper"},[s("div",{staticClass:"header"},[e._v("申请单关联")]),s("span",{staticClass:"split-line"}),e._l(e.requisitions,function(t,i){return s("div",{key:i,staticClass:"requisition-wrapper"},[s("div",{staticClass:"line"},[s("div",{staticClass:"number"},[e._v(e._s(t.expRequisitionNumber))]),s("div",{staticClass:"line-num"},[e._v("行号："+e._s(t.lineNumber))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"name"},[e._v("项目名称："+e._s(t.moReqItemName))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"payment"},[s("div",{staticClass:"code"},[e._v(e._s(t.paymentCurrencyCode))]),e._v("\n               \n              "),s("div",{staticClass:"amount"},[e._v(e._s(t.paymentPrice))])])])])}),s("div",{staticClass:"button",on:{click:e.relateRequisition}},[s("div",{staticClass:"dotted-button"},[s("div",{staticClass:"button-content"},[s("div",{staticClass:"button-content-text"},[e._v("新增申请单")]),s("div",{staticClass:"button-content-add"},[e._v("+")])])])])],2):e._e(),s("au-swipe",[e.showRefVat?s("div",{staticClass:"button-wrapper"},[s("div",{staticClass:"header"},[e._v("发票信息")]),s("span",{staticClass:"split-line"}),e._l(e.invoices,function(t,i){return s("au-swipe-item",{key:i,staticClass:"requisition-wrapper",attrs:{btns:e.swipeBtn},on:{"btn-click":function(s){return e.onSwipeBtnClick(t.invoiceId,t.refId,i)}}},[s("div",[s("div",{staticClass:"line num"},[s("div",{staticClass:"number"},[e._v("NO."+e._s(t.invoiceNumber))]),s("div",{staticClass:"date"},[e._v(e._s(t.invoiceDate))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"type-name"},[e._v(e._s(t.invoiceTypeName))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"code"},[e._v("发票代码："+e._s(t.invoiceCode))])]),s("div",{staticClass:"line"},[s("div",{staticClass:"payment"},[s("div",{staticClass:"code"},[e._v("CNY")]),e._v("\n                   \n                  "),s("div",{staticClass:"amount"},[e._v(e._s(t.amount))])])])])])}),s("div",{staticClass:"button",on:{click:e.relateInvoice}},[s("div",{staticClass:"dotted-button"},[s("div",{staticClass:"button-content"},[s("div",{staticClass:"button-content-text"},[e._v("新增发票")]),s("div",{staticClass:"button-content-add"},[e._v("+")])])])])],2):e._e()])],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"select-container"},[s("au-footer-bar",{attrs:{buttons:e.buttons}})],1)])])],1)},n=[],a=(s("3b2b"),s("a481"),s("96cf"),s("3b8d")),o=s("1fba"),r={mounted:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.refTypeText=sessionStorage.getItem("businessTypeName")||"费用类型",this.refBusValue=sessionStorage.getItem("busRefId")||0,this.refBusText=sessionStorage.getItem("expenseAmount")?"CNY "+sessionStorage.getItem("expenseAmount"):"请选择",this.totalAmount=sessionStorage.getItem("expenseAmount")||0,this.poolText=sessionStorage.getItem("poolText")||"请选择",this.poolValue=sessionStorage.getItem("poolValue")||0,this.confirmFlag=sessionStorage.getItem("confirmFlag")||"Y",this.reimburseExpense=sessionStorage.getItem("reimburseExpense")||0,e.next=10,this.$get({url:"/app/expense-pool/appPoolInit?page=1&size=10"});case 10:t=e.sent,console.log(t),this.headInfo=t.rows[0],new o["a"](this.$refs.datas,{});case 14:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),data:function(){return{placeholder:"请输入账本信息说明",expenseDate:"",expenseAmount:"0.00",originTitle:!0,buttons:[{class:"button-delete",text:"删除",callback:this.delete},{class:"button-save",text:"保存",callback:this.save}],headInfo:{},refBusText:"请选择",refBusValue:0,refTypeText:"费用类型",poolText:"请选择",poolValue:0,totalAmount:0,reimburseExpense:"0.00",sourceTypes:[],confirmFlag:"Y",expenseDesc:"",requisitions:[],invoices:[],swipeBtn:[{action:"delete",text:"删除",color:"#ff3a32"}]}},created:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,s,i,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this,Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[s]:("00"+t[s]).substr((""+t[s]).length)));return e},t.expenseDate=(new Date).Format("yyyy-MM-dd hh:mm:ss"),e.next=5,this.$post({url:"/app/expense-pool/appExpPoolTypeQuery",para:{page:1,zSize:10}});case 5:for(s=e.sent,console.log(s),i=s.rows,[],n=0;n<i.length;n++)t.sourceTypes.push({text:i[n].description,value:{id:i[n].moExpPoolTypeId,flag:i[n].confirmFlag}});i=null,a=this.initPoolId(),a&&(this.queryRequisition(a),this.queryInvoice(a));case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{queryRequisition:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$post({url:"/app/expense-pool/expensePoolRefReqQuery",para:{poolId:t,page:1,zSize:10}});case 2:s=e.sent,console.log("已关联申请单"),console.log(s),this.requisitions=s.rows;case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),queryInvoice:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$post({url:"/app/expense-pool/expensePoolRefVatQuery",para:{poolId:t,page:1,zSize:10}});case 2:s=e.sent,this.invoices=s.rows;case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),showTitle:function(){this.originTitle=!this.originTitle,new o["a"](this.$refs.datas,{})},selectPoolType:function(e,t,s){var i=e[0];this.poolValue=i.id,this.confirmFlag=i.flag,this.poolText=s[0],sessionStorage.setItem("poolText",s[0]),sessionStorage.setItem("poolValue",i.id),sessionStorage.setItem("confirmFlag",i.flag)},poolType:function(){this.pickers||(this.pickers=this.$createPicker({title:"费用类型",data:[this.sourceTypes],onSelect:this.selectPoolType,onCancel:function(){}})),this.pickers.show()},showKeyboard:function(){var e=this;this.$createKeyboard({value:this.value,onConfirm:function(t){e.reimburseExpense=t,sessionStorage.setItem("reimburseExpense",t)}}).show()},selectType:function(){this.$router.push({name:"select_expense_ref",query:{typeId:1}})},delete:function(){this.goBack()},save:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.saveDatas();case 2:t=e.sent,t.resu&&(console.log("保存成功，准备返回"),this.goBack());case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),saveDatas:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this,t={respCenterName:this.headInfo.respCenterName,respCenterId:this.headInfo.respCenterId,moExpPoolTypeId:parseInt(this.poolValue),busRefId:parseInt(this.refBusValue),accEntityId:this.headInfo.accEntityId,companyId:this.headInfo.companyId,unitId:this.headInfo.unitId,employeeId:this.headInfo.employeeId,currencyCode:this.headInfo.currencyCode,expenseDate:this.expenseDate,amount:parseFloat(this.totalAmount),companyAmount:parseFloat(this.reimburseExpense),sourceType:"MANUAL",description:this.expenseDesc,confirmFlag:"Y"},e.next=4,this.$post({url:"/app/expense-pool/submit",para:t});case 4:if(s=e.sent,!s.success){e.next=9;break}return e.abrupt("return",{resu:!0,data:s.rows[0]});case 9:return e.abrupt("return",{resu:!1});case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),initPoolId:function(){return sessionStorage.getItem("poolId")},getPoolId:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,s,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(sessionStorage.getItem("poolId")){e.next=9;break}return e.next=3,this.saveDatas();case 3:s=e.sent,i=s.data,t=i.poolId,sessionStorage.setItem("poolId",t),e.next=10;break;case 9:t=sessionStorage.getItem("poolId");case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),relateRequisition:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=this.getPoolId(),this.$router.push({name:"relate_requisition",query:{poolId:t,moExpPoolTypeId:this.poolValue,busRefId:this.refBusValue}});case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),relateInvoice:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getPoolId();case 2:t=e.sent,this.$router.push({name:"relate_invoice",query:{poolId:t,employeeId:this.headInfo.employeeId,accEntityId:this.headInfo.accEntityId}});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),goBack:function(){sessionStorage.removeItem("businessTypeName"),sessionStorage.removeItem("busRefId"),sessionStorage.removeItem("expenseAmount"),sessionStorage.removeItem("poolText"),sessionStorage.removeItem("poolValue"),sessionStorage.removeItem("confirmFlag"),sessionStorage.removeItem("reimburseExpense"),sessionStorage.removeItem("poolId"),this.$router.go(-1)},onSwipeBtnClick:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,s,i){var n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getPoolId();case 2:n=e.sent,a=this,console.log(n),console.log(t),this.$post({url:"/app/exp/expense-pool-ref-vat/submit",para:{lines:[{poolId:parseInt(n),invoiceId:t,refId:s,status:"delete"}]}}).then(function(e){console.log(e),a.invoices.splice(i,1)});case 7:case"end":return e.stop()}},e,this)}));function t(t,s,i){return e.apply(this,arguments)}return t}()},computed:{recordsData:function(){var e=this.ds?this.ds.getAllRecordData():"";return e},collapseTitle:function(){return this.originTitle?"收起":"展开"},collapseMargin:function(){return this.originTitle?"0px":"12px"},showRequisition:function(){return 0!=this.poolValue&&0!=this.refBusValue},showRefVat:function(){return void 0!=this.headInfo.employeeId&&void 0!=this.headInfo.accEntityId}}},c=r,l=(s("3a0a"),s("2877")),u=Object(l["a"])(c,i,n,!1,null,"02e3e5a4",null);t["default"]=u.exports}}]);